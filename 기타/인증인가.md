## 인증&인가 정의
인증: 유저가 누구인지 확인하는 절차
인가: 유저의 요청에 대한 권환을 확인하고 허가 해주는 것

## 세션 방식의 인증&인가 처리
인증&인가를 처리하기 위해서는 상태 유지가 필요하다. http 요청은 무상태이기 때문에 각 요청은 독립적이다.
따라서, http 요청에서도 상태를 갖게 하기 위해서 http에 쿠키라는 특징을 갖게 함
상태 유지를 하기 위해서 모든 값을 쿠키에 담아 처리하는 것은 http 헤더 자체가 커져 무거워지고 보안상 이슈가 있다.(쿠키 크기에 제한이 있다. 4KB)
여러 설정을 통해서 외부에서 쿠키에 접근하는 것을 막을 수 있지만 결국 쿠키라는 것은 로컬(사용자 PC)에 저장되는 데이터이기 때문에 PC 해킹하여 쿠키 값을 읽을 수도 있고 아니면 사용자가 직접 값을 수정하여 전송할 수 있다.
예를 들어, is_admin=false 라는 쿠키 값이 있다면 사용자가 true 로 바꿔 처리할 수 있다.

따라서, 그 다음에 등장한 것이 세션이다. 데이터들을 서버의 메모리에 저장하고 세션 아이디만 쿠키에 담아 처리한다.
=> 성능, 쿠키 크기 제한, 보안 이슈를 모두 해결할 수 있다.

세션 처리 방식는 다중 서버일 때 문제가 발생한다. 특정 사용자의 상태 값은 특정 서버에 존재하는데 다른 서버로 요청이 간다면 다시 로그인을 해야 한다.

해결 방법
=> 1. 스티키 세션: 사용자의 요청을 세션 정보를 가진 서버로 고정한다. => 서버 앞 단에 처리(LB, Gateway) => 추가적인 로직 처리로 성능 악화, 다중 서버의 의미가 사라진다.
=> 2. 별도의 세션 스토어: 공통의 세션 저장소를 만들어 처리한다. => 네트워크를 한번 더 타야 한다.
=> 보통 2번 방법을 사용한다. 

## 토큰 방식의 인증&인가 처리
토큰 방식의 인증에서 JWT를 많이 사용하니 JWT=엑세스토큰이라고 생각하는 사람이 많겠지만, 엑세스 토큰의 정의는 다음과 같다.
- 엑세스 토큰: 보호된 리소스에 접근하기 위한 자격 증명

엑세스 토큰으로 아무 의미 없는 값이 사용되었고 DB 에서 사용자의 인증 및 인가 정보를 가져와 사용했다. 사실 이 방식은 쿠키&세션 기반의 인증 인가와 다를 게 없다. 오히려, DB 접근이 더 성능이 안 좋았다.

JWT 토큰의 등장으로 토큰 안에 사용자의 인증 인가 정보를 담을 수 있게 되면서 서버에서 상태를 관리할 필요가 없어졌다. 성능과 보안이 더 좋다고 할 수 있다. 쿠키의 경우 로컬에 남지만, 토큰은 헤더에 넣기 때문에 보안 상 더 좋다.

하지만, 토큰의 가장 큰 문제는 토큰을 발행하고 나서 서버에서 토큰에 대한 제어를 할 수 없다는 것이다. 
토큰에 대한 제어를 하기 위해서 엑세스 토큰/리프래쉬 토큰 과 블랙 리스트라는 개념이 등장한다.
- 액세스 토큰/리프래쉬 토큰: 서버에서 토큰에 대한 제어권이 사라지니, 액세스 토큰의 만료 시간을 짧게 가져간다. 또, 그렇게 되면 자주 로그인해야 하는 상황이 발생하니 리프래쉬 토큰(엑세스 토큰보다 만료 시간이 긺)이 나온다.
- 블랙 리스트 처리: 만료 시간이 되지 않은 토큰에 대해서 로그아웃을 하면 해당 토큰은 더 이상 사용되면 안된다. 만약, 타인이 해당 토큰을 사용하여 인증/인가를 한다면 큰 문제가 발생할 수 있다. 액세스 토큰은 짧기 때문에 블랙 리스트로 관리하는 경우도 거의 없다. 보통, 리프래쉬 토큰을 블랙 리스트로 관리한다.



